================================================================================
TENNIS BETTING SYSTEM - STATE MACHINE DIAGRAMS
================================================================================
Generated: January 20, 2026
Updated: January 22, 2026

================================================================================
1. APPLICATION STARTUP FLOW
================================================================================

    ┌─────────────────┐
    │     START       │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │  Check if       │
    │  Frozen (.exe)  │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
┌─────────┐    ┌─────────────┐
│ Script  │    │   Frozen    │
│  Mode   │    │    Mode     │
└────┬────┘    └──────┬──────┘
     │                │
     │                ▼
     │         ┌─────────────────┐
     │         │ Check Public    │
     │         │ Documents exists│
     │         └────────┬────────┘
     │                  │
     │          ┌───────┴───────┐
     │          │               │
     │          ▼               ▼
     │    ┌──────────┐    ┌──────────────┐
     │    │  Exists  │    │ First Run    │
     │    └────┬─────┘    └──────┬───────┘
     │         │                 │
     │         │                 ▼
     │         │         ┌───────────────────┐
     │         │         │ Copy seed files:  │
     │         │         │ - tennis_betting  │
     │         │         │   .db             │
     │         │         │ - name_mappings   │
     │         │         │   .json           │
     │         │         └─────────┬─────────┘
     │         │                   │
     │         └─────────┬─────────┘
     │                   │
     └─────────┬─────────┘
               │
               ▼
      ┌─────────────────┐
      │  Create Tables  │
      │  (if needed)    │
      └────────┬────────┘
               │
               ▼
      ┌─────────────────┐
      │  Load Main UI   │
      └────────┬────────┘
               │
               ▼
      ┌─────────────────┐
      │     READY       │
      └─────────────────┘


================================================================================
2. BETFAIR MATCH CAPTURE FLOW
================================================================================

    ┌─────────────────┐
    │  Click Capture  │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Load Betfair    │
    │ Credentials     │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
┌─────────┐    ┌─────────────┐
│ Missing │    │   Valid     │
│ Creds   │    │   Creds     │
└────┬────┘    └──────┬──────┘
     │                │
     ▼                ▼
┌─────────┐    ┌─────────────────┐
│ Show    │    │ Call Betfair    │
│ Error   │    │ Tennis API      │
└────┬────┘    └────────┬────────┘
     │                  │
     │                  ▼
     │         ┌─────────────────┐
     │         │ Parse Matches   │
     │         └────────┬────────┘
     │                  │
     │                  ▼
     │         ┌─────────────────┐
     │         │ For Each Match: │
     │         │ Match Players   │◄─────────────┐
     │         └────────┬────────┘              │
     │                  │                       │
     │                  ▼                       │
     │         ┌─────────────────┐              │
     │         │ Name Matcher    │              │
     │         │ (see Flow #3)   │              │
     │         └────────┬────────┘              │
     │                  │                       │
     │          ┌───────┴───────┐               │
     │          │               │               │
     │          ▼               ▼               │
     │    ┌──────────┐    ┌──────────┐          │
     │    │  Found   │    │   Not    │          │
     │    │          │    │  Found   │          │
     │    └────┬─────┘    └────┬─────┘          │
     │         │               │               │
     │         ▼               ▼               │
     │    ┌──────────┐    ┌──────────┐          │
     │    │ Link to  │    │ Mark as  │          │
     │    │ Player   │    │ Unknown  │          │
     │    └────┬─────┘    └────┬─────┘          │
     │         │               │               │
     │         └───────┬───────┘               │
     │                 │                       │
     │                 ▼                       │
     │         ┌─────────────────┐             │
     │         │ More Matches?   │─────Yes─────┘
     │         └────────┬────────┘
     │                  │ No
     │                  ▼
     │         ┌─────────────────┐
     │         │ Save to         │
     │         │ upcoming_matches│
     │         └────────┬────────┘
     │                  │
     └─────────┬────────┘
               │
               ▼
      ┌─────────────────┐
      │ Display in UI   │
      └─────────────────┘


================================================================================
3. PLAYER NAME MATCHING FLOW
================================================================================

    ┌─────────────────┐
    │ Betfair Name    │
    │ Input           │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Check           │
    │ name_mappings   │
    │ .json           │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
┌─────────┐    ┌─────────────┐
│ Direct  │    │ Not in      │
│ Match   │    │ Mappings    │
└────┬────┘    └──────┬──────┘
     │                │
     │                ▼
     │         ┌─────────────────┐
     │         │ Strategy 1:     │
     │         │ Exact Match     │
     │         └────────┬────────┘
     │                  │
     │          ┌───────┴───────┐
     │          │               │
     │          ▼               ▼
     │       Found           Not Found
     │          │               │
     │          │               ▼
     │          │        ┌─────────────────┐
     │          │        │ Strategy 2:     │
     │          │        │ Normalized      │
     │          │        │ (remove -, ')   │
     │          │        └────────┬────────┘
     │          │                 │
     │          │         ┌───────┴───────┐
     │          │         │               │
     │          │         ▼               ▼
     │          │      Found           Not Found
     │          │         │               │
     │          │         │               ▼
     │          │         │        ┌─────────────────┐
     │          │         │        │ Strategy 3:     │
     │          │         │        │ First%Last      │
     │          │         │        └────────┬────────┘
     │          │         │                 │
     │          │         │         ┌───────┴───────┐
     │          │         │         │               │
     │          │         │         ▼               ▼
     │          │         │      Found           Not Found
     │          │         │         │               │
     │          │         │         │               ▼
     │          │         │         │        ┌─────────────────┐
     │          │         │         │        │ Strategy 4:     │
     │          │         │         │        │ LastName First  │
     │          │         │         │        └────────┬────────┘
     │          │         │         │                 │
     │          │         │         │         ┌───────┴───────┐
     │          │         │         │         │               │
     │          │         │         │         ▼               ▼
     │          │         │         │      Found           Not Found
     │          │         │         │         │               │
     │          │         │         │         │               ▼
     │          │         │         │         │        ┌─────────────────┐
     │          │         │         │         │        │ Strategy 5:     │
     │          │         │         │         │        │ Fuzzy Match     │
     │          │         │         │         │        │ (similarity)    │
     │          │         │         │         │        └────────┬────────┘
     │          │         │         │         │                 │
     │          │         │         │         │         ┌───────┴───────┐
     │          │         │         │         │         │               │
     │          │         │         │         │         ▼               ▼
     │          │         │         │         │    Score > 0.7     Score < 0.7
     │          │         │         │         │         │               │
     └──────────┴─────────┴─────────┴─────────┴─────────┤               │
                                                        │               │
                                                        ▼               ▼
                                               ┌─────────────┐   ┌─────────────┐
                                               │  PLAYER     │   │  UNKNOWN    │
                                               │  FOUND      │   │  (P1/P2     │
                                               │             │   │  unknown)   │
                                               └─────────────┘   └─────────────┘


================================================================================
4. MATCH ANALYSIS FLOW
================================================================================

    ┌─────────────────┐
    │ Select Match    │
    │ (Double-click)  │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Get Player IDs  │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
┌─────────┐    ┌─────────────┐
│ Both    │    │ Missing     │
│ Found   │    │ Player(s)   │
└────┬────┘    └──────┬──────┘
     │                │
     │                ▼
     │         ┌─────────────┐
     │         │ Show Error  │
     │         └─────────────┘
     │
     ▼
┌─────────────────────────────────────────────────────────────┐
│                    PARALLEL ANALYSIS                         │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │   RANKING    │  │    FORM      │  │   SURFACE    │       │
│  │   FACTOR     │  │   FACTOR     │  │   FACTOR     │       │
│  │              │  │              │  │              │       │
│  │ - Get ranks  │  │ - Last 10    │  │ - Career %   │       │
│  │ - Or estimate│  │   matches    │  │ - Recent %   │       │
│  │   from odds  │  │ - Win rate   │  │ - Weighted   │       │
│  │ - Compare    │  │ - Recency    │  │   combine    │       │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘       │
│         │                 │                 │               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │     H2H      │  │   FATIGUE    │  │   INJURY     │       │
│  │   FACTOR     │  │   FACTOR     │  │   FACTOR     │       │
│  │              │  │              │  │              │       │
│  │ - Direct     │  │ - Rest days  │  │ - Check      │       │
│  │   matches    │  │ - Workload   │  │   injury     │       │
│  │ - Win rate   │  │ - Difficulty │  │   status     │       │
│  │              │  │ - Fitness    │  │              │       │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘       │
│         │                 │                 │               │
└─────────┴─────────────────┴─────────────────┴───────────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Apply Weights:  │
                   │ - Form: 20%     │
                   │ - Ranking: 20%  │
                   │ - Surface: 15%  │
                   │ - H2H: 10%      │
                   │ - Opp Qual: 10% │
                   │ - Recency: 8%   │
                   │ - Fatigue: 5%   │
                   │ - Injury: 5%    │
                   │ - Loss: 5%      │
                   │ - Momentum: 2%  │
                   └────────┬────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Calculate Win   │
                   │ Probability     │
                   └────────┬────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Calculate EV    │
                   │ vs Betfair Odds │
                   └────────┬────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Display         │
                   │ Analysis Dialog │
                   └─────────────────┘


================================================================================
5. FATIGUE CALCULATION FLOW
================================================================================

    ┌─────────────────┐
    │ Player ID +     │
    │ Match Date      │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Get Recent      │
    │ Matches (30d)   │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Find Last       │
    │ Match Date      │
    └────────┬────────┘
             │
             ▼
┌─────────────────────────────────────────────────────────────┐
│                    CALCULATE COMPONENTS                      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │              REST COMPONENT (40 pts)                │     │
│  │                                                     │     │
│  │   Days Since Last Match                             │     │
│  │         │                                           │     │
│  │   ┌─────┴─────┬─────────────┬──────────────┐       │     │
│  │   ▼           ▼             ▼              ▼       │     │
│  │  0-2d       3-6d          7-13d         14+d       │     │
│  │  Tired      Optimal       Rusty       Very Rusty   │     │
│  │  30pts      40pts         35pts         25pts      │     │
│  │                                                     │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │            WORKLOAD COMPONENT (40 pts)              │     │
│  │                                                     │     │
│  │   Count Matches in Windows:                         │     │
│  │   - 7 days                                          │     │
│  │   - 14 days (threshold: 5)                          │     │
│  │   - 30 days (threshold: 10)                         │     │
│  │                                                     │     │
│  │   Calculate Difficulty:                             │     │
│  │   ┌─────────────────────────────────────────┐      │     │
│  │   │ For each match in 7 days:               │      │     │
│  │   │   Walkover/Ret    → 0.5 pts             │      │     │
│  │   │   Quick 2-setter  → 1.0 pts             │      │     │
│  │   │   Competitive 3   → 2.0 pts             │      │     │
│  │   │   Marathon 5      → 3.0 pts             │      │     │
│  │   └─────────────────────────────────────────┘      │     │
│  │                                                     │     │
│  │   Overload Check:                                   │     │
│  │   - >5 matches in 14d → Penalty                     │     │
│  │   - >10 matches in 30d → Penalty                    │     │
│  │   - Difficulty >6 pts → Penalty                     │     │
│  │                                                     │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │            BASE FITNESS (20 pts)                    │     │
│  │                                                     │     │
│  │   Default: 20 pts                                   │     │
│  │   (Could factor in age, injury history)             │     │
│  │                                                     │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ TOTAL SCORE     │
                   │ = Rest + Work   │
                   │   + Base        │
                   └────────┬────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Determine       │
                   │ Status          │
                   └────────┬────────┘
                            │
            ┌───────────────┼───────────────┐
            │               │               │
            ▼               ▼               ▼
      ┌──────────┐   ┌──────────┐   ┌──────────┐
      │  90-100  │   │  70-89   │   │   <70    │
      │  Fresh   │   │  Normal  │   │ Fatigued │
      └──────────┘   └──────────┘   └──────────┘


================================================================================
6. TENNIS EXPLORER IMPORT FLOW
================================================================================

    ┌─────────────────┐
    │ Click "Import   │
    │ from TE"        │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Enter Player    │
    │ Name/URL        │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Scrape TE       │
    │ Player Page     │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Parse Match     │◄──────────────────────┐
    │ Rows            │                       │
    └────────┬────────┘                       │
             │                                │
             ▼                                │
    ┌─────────────────┐                       │
    │ Is Tournament   │                       │
    │ Header?         │                       │
    └────────┬────────┘                       │
             │                                │
     ┌───────┴───────┐                        │
     │               │                        │
     ▼               ▼                        │
   Yes              No                        │
     │               │                        │
     ▼               ▼                        │
┌─────────┐   ┌─────────────┐                 │
│ Update  │   │ Parse Match │                 │
│ Current │   │ Data:       │                 │
│ Tourney │   │ - Date      │                 │
│ & Sfc   │   │ - Opponent  │                 │
└────┬────┘   │ - Score     │                 │
     │        │ - Round     │                 │
     │        └──────┬──────┘                 │
     │               │                        │
     │               ▼                        │
     │        ┌─────────────┐                 │
     │        │ Is Balance/ │                 │
     │        │ Stats Table?│                 │
     │        └──────┬──────┘                 │
     │               │                        │
     │       ┌───────┴───────┐                │
     │       │               │                │
     │       ▼               ▼                │
     │     Yes              No                │
     │       │               │                │
     │       ▼               │                │
     │  ┌─────────┐          │                │
     │  │ Skip    │          │                │
     │  │ (wrong  │          │                │
     │  │ data)   │          │                │
     │  └────┬────┘          │                │
     │       │               │                │
     └───────┴───────────────┴────────────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Year Boundary   │
                   │ Check (Jan on   │
                   │ prev year page) │
                   └────────┬────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Deduplicate     │
                   │ (same date,     │
                   │ opponent, score)│
                   └────────┬────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Display Preview │
                   └────────┬────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Click "Import"  │
                   └────────┬────────┘
                            │
                            ▼
    ┌─────────────────────────────────────────────────────────┐
    │                    FOR EACH MATCH                        │
    ├─────────────────────────────────────────────────────────┤
    │                                                          │
    │    ┌─────────────────┐                                   │
    │    │ Match Players   │                                   │
    │    │ to Database     │                                   │
    │    └────────┬────────┘                                   │
    │             │                                            │
    │     ┌───────┴───────┐                                    │
    │     │               │                                    │
    │     ▼               ▼                                    │
    │  Found           Unknown                                 │
    │     │               │                                    │
    │     ▼               ▼                                    │
    │  ┌────────┐    ┌────────────┐                           │
    │  │ INSERT │    │ Skip Match │                           │
    │  │ Match  │    │ (players   │                           │
    │  │        │    │  locked)   │                           │
    │  └────────┘    └────────────┘                           │
    │                                                          │
    └─────────────────────────────────────────────────────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Show Import     │
                   │ Results         │
                   └─────────────────┘


================================================================================
7. BET SUGGESTION FLOW
================================================================================

    ┌─────────────────┐
    │ Click "Analyze  │
    │ All"            │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Get All         │
    │ Upcoming Matches│
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ For Each Match  │◄─────────────────────┐
    └────────┬────────┘                      │
             │                               │
             ▼                               │
    ┌─────────────────┐                      │
    │ Both Players    │                      │
    │ Found?          │                      │
    └────────┬────────┘                      │
             │                               │
     ┌───────┴───────┐                       │
     │               │                       │
     ▼               ▼                       │
    No              Yes                      │
     │               │                       │
     ▼               ▼                       │
┌─────────┐   ┌─────────────┐                │
│ Mark    │   │ Run Match   │                │
│ Status: │   │ Analysis    │                │
│ Unknown │   │ (Flow #4)   │                │
└────┬────┘   └──────┬──────┘                │
     │               │                       │
     │               ▼                       │
     │        ┌─────────────────┐            │
     │        │ Calculate:      │            │
     │        │ - Win Prob      │            │
     │        │ - Model Odds    │            │
     │        │ - Confidence    │            │
     │        └────────┬────────┘            │
     │                 │                     │
     │                 ▼                     │
     │        ┌─────────────────┐            │
     │        │ Confidence      │            │
     │        │ >= 40%?         │            │
     │        └────────┬────────┘            │
     │                 │                     │
     │         ┌───────┴───────┐             │
     │         │               │             │
     │         ▼               ▼             │
     │        Yes              No            │
     │         │               │             │
     │         ▼               ▼             │
     │   ┌──────────┐    ┌──────────┐        │
     │   │ Calc EV  │    │ Mark:    │        │
     │   │ vs Odds  │    │ Low Conf │        │
     │   └────┬─────┘    └────┬─────┘        │
     │        │               │             │
     │        ▼               │             │
     │   ┌──────────┐         │             │
     │   │ EV > 5%? │         │             │
     │   └────┬─────┘         │             │
     │        │               │             │
     │    ┌───┴───┐           │             │
     │    │       │           │             │
     │    ▼       ▼           │             │
     │   Yes      No          │             │
     │    │       │           │             │
     │    ▼       ▼           │             │
     │ ┌──────┐ ┌──────┐      │             │
     │ │VALUE │ │ No   │      │             │
     │ │ BET  │ │ Edge │      │             │
     │ └──┬───┘ └──┬───┘      │             │
     │    │        │          │             │
     └────┴────────┴──────────┴─────────────┘
                   │
                   ▼
          ┌─────────────────┐
          │ Calculate Units │
          │ (Edge-based)    │
          └────────┬────────┘
                   │
                   ▼
          ┌─────────────────┐
          │ Sort by EV      │
          │ Display Results │
          └─────────────────┘


================================================================================
8. UNIT STAKING CALCULATION FLOW
================================================================================

    ┌─────────────────┐
    │ Model Prob +    │
    │ Betfair Odds    │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Calculate Edge  │
    │ = Model Prob -  │
    │   Implied Prob  │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Edge >= 5%?     │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
    No              Yes
     │               │
     ▼               ▼
┌─────────┐   ┌─────────────┐
│ No Bet  │   │ Determine   │
│         │   │ Edge Tier   │
└─────────┘   └──────┬──────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
         ▼           ▼           ▼
    ┌─────────┐ ┌─────────┐ ┌─────────┐
    │ 5-10%   │ │ 10-15%  │ │  15%+   │
    │ Edge    │ │ Edge    │ │ Edge    │
    │         │ │         │ │         │
    │ 1 Unit  │ │ 2 Units │ │ 3 Units │
    └────┬────┘ └────┬────┘ └────┬────┘
         │           │           │
         └───────────┴───────────┘
                     │
                     ▼
            ┌─────────────────┐
            │ Check Odds      │
            │ Scaling         │
            └────────┬────────┘
                     │
     ┌───────────────┼───────────────┐
     │               │               │
     ▼               ▼               ▼
┌─────────┐    ┌─────────┐    ┌─────────┐
│ <2.00   │    │2.00-5.00│    │  >5.00  │
│ Short   │    │ Medium  │    │Longshot │
│         │    │         │    │         │
│ Max 3u  │    │ Max 2u  │    │ Max 1u  │
└────┬────┘    └────┬────┘    └────┬────┘
     │              │              │
     └──────────────┴──────────────┘
                    │
                    ▼
           ┌─────────────────┐
           │ Edge > 20%?     │
           │ (Override)      │
           └────────┬────────┘
                    │
            ┌───────┴───────┐
            │               │
            ▼               ▼
           Yes              No
            │               │
            ▼               ▼
      ┌──────────┐    ┌──────────┐
      │ Use Edge │    │ Use Odds │
      │ Units    │    │ Cap      │
      └────┬─────┘    └────┬─────┘
           │               │
           └───────┬───────┘
                   │
                   ▼
          ┌─────────────────┐
          │ Final Units     │
          │ (max 3)         │
          └────────┬────────┘
                   │
                   ▼
          ┌─────────────────┐
          │ Stake =         │
          │ Units × 2%      │
          │ × Bankroll      │
          └─────────────────┘


================================================================================
9. BET TRACKER - ADD BET FLOW
================================================================================

    ┌─────────────────┐
    │ Click "New Bet" │
    │ OR Prefill from │
    │ Bet Suggester   │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Show Add Bet    │
    │ Dialog          │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Fill Fields:    │
    │ - Date/Time     │
    │ - Tournament    │
    │ - Match         │
    │ - Market        │
    │ - Selection     │
    │ - Stake/Odds    │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Click "Add Bet" │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Validate Input  │
    │ (stake, odds)   │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
  Invalid          Valid
     │               │
     ▼               ▼
┌─────────┐   ┌─────────────────┐
│ Show    │   │ Check Duplicate │
│ Error   │   │ (match_desc +   │
└─────────┘   │  selection)     │
              └────────┬────────┘
                       │
               ┌───────┴───────┐
               │               │
               ▼               ▼
          Duplicate       No Duplicate
               │               │
               ▼               ▼
         ┌──────────┐    ┌──────────────┐
         │ Show     │    │ Save to DB   │
         │ "Already │    └──────┬───────┘
         │  exists" │           │
         │ Error    │           ▼
         └──────────┘    ┌──────────────┐
                         │ Send Discord │
                         │ Notification │
                         │ (if webhook) │
                         └──────┬───────┘
                                │
                                ▼
                         ┌──────────────┐
                         │ Close Dialog │
                         │ Refresh UI   │
                         └──────────────┘


================================================================================
10. BET TRACKER - SETTLE BET FLOW
================================================================================

    ┌─────────────────┐
    │ Select Pending  │
    │ Bet             │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Click Win/Loss/ │
    │ Void Button     │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Get Bet Data    │
    │ (stake, odds)   │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Calculate P/L:  │
    └────────┬────────┘
             │
     ┌───────┼───────┬───────┐
     │       │       │       │
     ▼       ▼       ▼       ▼
   Win     Loss    Void   Re-settle
     │       │       │       │
     ▼       ▼       ▼       ▼
┌────────┐ ┌────┐ ┌────┐ ┌────────────┐
│Profit= │ │P/L │ │P/L │ │ Confirm    │
│stake × │ │= - │ │= 0 │ │ "Change to │
│(odds-1)│ │stake│     │ │  [result]?"│
│×(1-com)│ │    │ │    │ └─────┬──────┘
└───┬────┘ └─┬──┘ └─┬──┘       │
    │        │      │          │
    └────────┴──────┴──────────┘
                    │
                    ▼
           ┌─────────────────┐
           │ Update DB:      │
           │ - result        │
           │ - profit_loss   │
           │ - settled_at    │
           └────────┬────────┘
                    │
                    ▼
           ┌─────────────────┐
           │ Send Discord    │
           │ Notification    │
           │ (color by       │
           │  result)        │
           └────────┬────────┘
                    │
                    ▼
           ┌─────────────────┐
           │ Refresh UI      │
           └─────────────────┘


================================================================================
11. BET TRACKER - IN PROGRESS TOGGLE FLOW
================================================================================

    ┌─────────────────┐
    │ Select Pending  │
    │ Bet             │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Click           │
    │ "In Progress"   │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Get Current     │
    │ Status          │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
  Currently      Not In
  In Progress    Progress
     │               │
     ▼               ▼
┌──────────┐   ┌──────────┐
│ Set to   │   │ Set to   │
│ FALSE    │   │ TRUE     │
└────┬─────┘   └────┬─────┘
     │              │
     ▼              ▼
┌──────────┐   ┌──────────┐
│ Discord: │   │ Discord: │
│ "Status  │   │ "Match   │
│ Reverted"│   │ Started" │
│ (gray)   │   │ (blue)   │
└────┬─────┘   └────┬─────┘
     │              │
     └──────┬───────┘
            │
            ▼
   ┌─────────────────┐
   │ Refresh Table   │
   │ (blue highlight │
   │  if in progress)│
   └─────────────────┘


================================================================================
12. DISCORD NOTIFICATION FLOW
================================================================================

    ┌─────────────────┐
    │ Bet Action      │
    │ Triggered       │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Get Webhook URL │
    │ from app_       │
    │ settings table  │
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
   Empty          Has URL
     │               │
     ▼               ▼
┌─────────┐   ┌─────────────────┐
│ Silent  │   │ Build Embed     │
│ Return  │   └────────┬────────┘
└─────────┘            │
                       ▼
              ┌─────────────────┐
              │ Determine Type  │
              └────────┬────────┘
                       │
     ┌─────────┬───────┼───────┬─────────┐
     │         │       │       │         │
     ▼         ▼       ▼       ▼         ▼
  ┌─────┐  ┌─────┐ ┌─────┐ ┌─────┐  ┌─────────┐
  │ Add │  │Settl│ │Edit │ │ In  │  │ Batch   │
  │ Bet │  │  e  │ │     │ │Prog │  │ Add     │
  └──┬──┘  └──┬──┘ └──┬──┘ └──┬──┘  └────┬────┘
     │        │       │       │          │
     ▼        ▼       ▼       ▼          ▼
  Green    Win:Green Amber  Blue      Green
           Loss:Red         /Gray     +Table
           Void:Gray
     │        │       │       │          │
     └────────┴───────┴───────┴──────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ Spawn Background│
              │ Thread          │
              └────────┬────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ POST to Discord │
              │ Webhook URL     │
              │ (5s timeout)    │
              └────────┬────────┘
                       │
               ┌───────┴───────┐
               │               │
               ▼               ▼
            Success         Failure
               │               │
               ▼               ▼
          ┌─────────┐    ┌─────────┐
          │ Message │    │ Silent  │
          │ Appears │    │ Fail    │
          │ in      │    │ (don't  │
          │ Discord │    │ disrupt │
          └─────────┘    │ app)    │
                         └─────────┘


================================================================================
13. MASS-ADD BETS FROM SUGGESTER FLOW
================================================================================

    ┌─────────────────┐
    │ Click "Add All  │
    │ to Tracker"     │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Confirm Dialog: │
    │ "Add all X bets?│
    └────────┬────────┘
             │
     ┌───────┴───────┐
     │               │
     ▼               ▼
    No              Yes
     │               │
     ▼               ▼
┌─────────┐   ┌─────────────────┐
│ Cancel  │   │ Init Counters:  │
└─────────┘   │ added=0         │
              │ skipped=0       │
              │ added_bets=[]   │
              └────────┬────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ For Each Bet    │◄────────┐
              └────────┬────────┘         │
                       │                  │
                       ▼                  │
              ┌─────────────────┐         │
              │ Check Duplicate │         │
              │ (match + select)│         │
              └────────┬────────┘         │
                       │                  │
               ┌───────┴───────┐          │
               │               │          │
               ▼               ▼          │
          Duplicate       Not Dup         │
               │               │          │
               ▼               ▼          │
         ┌──────────┐    ┌──────────┐     │
         │ skipped++│    │ Add to DB│     │
         └────┬─────┘    │ added++  │     │
              │          │ Track bet│     │
              │          └────┬─────┘     │
              │               │           │
              └───────┬───────┘           │
                      │                   │
                      ▼                   │
              ┌─────────────────┐         │
              │ More Bets?      │────Yes──┘
              └────────┬────────┘
                       │ No
                       ▼
              ┌─────────────────┐
              │ Send Batch      │
              │ Discord Notif   │
              │ (table format)  │
              └────────┬────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ Show Result:    │
              │ "Added X bets.  │
              │ Y duplicates    │
              │ skipped."       │
              └────────┬────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ Disable "Add    │
              │ All" Button     │
              └─────────────────┘


================================================================================
14. SETTINGS DIALOG FLOW (Discord Webhook)
================================================================================

    ┌─────────────────┐
    │ Click "Settings"│
    │ in Bet Tracker  │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Load Current    │
    │ Webhook URL     │
    │ from DB         │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Show Dialog:    │
    │ - URL Input     │
    │ - Test Button   │
    │ - Save/Cancel   │
    └────────┬────────┘
             │
     ┌───────┴───────┬───────────┐
     │               │           │
     ▼               ▼           ▼
   Test           Save        Cancel
     │               │           │
     ▼               ▼           ▼
┌──────────┐  ┌──────────┐  ┌─────────┐
│ Save URL │  │ Save URL │  │ Close   │
│ Temp     │  │ to DB    │  │ Dialog  │
└────┬─────┘  └────┬─────┘  └─────────┘
     │             │
     ▼             ▼
┌──────────┐  ┌──────────┐
│ Send     │  │ Show     │
│ Test Msg │  │ "Saved"  │
└────┬─────┘  │ & Close  │
     │        └──────────┘
     │
 ┌───┴───┐
 │       │
 ▼       ▼
OK     Fail
 │       │
 ▼       ▼
┌────┐ ┌────────┐
│Succ│ │ "Check │
│ess │ │ your   │
│Msg│ │ URL"   │
└────┘ └────────┘


================================================================================
END OF STATE MACHINE DIAGRAMS
================================================================================
